<!DOCTYPE html>

<html>	
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=Edge">
	<!--[if lt IE 9]>
	<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/aight/1.2.2/aight.min.js"></script>
	<![endif]-->
	<title>Lyric Analysis - Rolling Stone Top 100 Artists</title>
</head>
<style>

text {
  font: 10px sans-serif;
}

.chart rect {
  fill: steelblue;
}

.chart text {
  fill: black;
  font: 12px monospace;
  text-anchor: left;
}

.bubble text {
  fill: black;
  font: 12px monospace;
}

.chart3 text {
  fill: black;
  font: 12px monospace;
  text-anchor: right;
}

/*********************/
@import url(http://fonts.googleapis.com/css?family=Open+Sans);

body { 
  font-family: 'Open Sans', sans-serif;
  color: #666;
}

body h1 {
	font-size: 1em;
}

body p {
	font-size: 0.75em;
}

/* STRUCTURE */

#pagewrap {
	padding: 5px;
	width: 1100px;
	margin: 20px auto;
}
#header {
	/*height: 100px;*/
	padding: 0 15px;
}
#leftCol {
	width: 290px;
	float: left;
	padding: 5px 15px;
}

#centerCol {
	width: 484px; /* Account for margins + border values */
	float: left;
	padding: 5px 15px;
	margin: 0px 5px 5px 5px;
}

#rightCol {
	width: 220px;
	padding: 5px 15px;
	float: left;
}
#footer {
	clear: both;
	padding: 0 15px;
}

/************************************************************************************
MEDIA QUERIES
*************************************************************************************/
/* for 980px or less */
@media screen and (max-width: 980px) {
	
	#pagewrap {
		width: 94%;
	}
	#content {
		width: 41%;
		padding: 1% 4%;
	}
	#middle {
		width: 41%;
		padding: 1% 4%;
		margin: 0px 0px 5px 5px;
		float: right;
	}
	
	#sidebar {
		clear: both;
		padding: 1% 4%;
		width: auto;
		float: none;
	}

	#header, #footer {
		padding: 1% 4%;
	}
}

/* for 700px or less */
@media screen and (max-width: 600px) {

	#content {
		width: auto;
		float: none;
	}
	
	#middle {
		width: auto;
		float: none;
		margin-left: 0px;
	}
	
	#sidebar {
		width: auto;
		float: none;
	}

}

/* for 480px or less */
@media screen and (max-width: 480px) {

	#header {
		height: auto;
	}
	h1 {
		font-size: 2em;
	}
	#sidebar {
		display: none;
	}

}


#content {
	background: #f8f8f8;
}
#sidebar {
	background: #f0efef;
}
#header, #content, #middle, #sidebar {
	margin-bottom: 5px;
}

#pagewrap, #header, #content, #middle, #sidebar, #footer {
	border: solid 1px #ccc;
}


/*********************/
	

</style>
<body>
	<div id="pagewrap">
		<div id="header">
			<p style="font-size: 50px;">Lyric Analysis - Rolling Stone Top 100 Artists</p>
			<p>Also check out a similar analysis on <a href="/museAck/subredditFirstN.html">Reddit's Default Subreddit comments</a></p>
			<p>
			After seeing this <a href="http://rappers.mdaniels.com.s3-website-us-east-1.amazonaws.com/"> analysis of the lyrics used by hip hop artists</a>, 
			I was curious to see how these numbers stacked up with other artist in other genres. So this is what I've got so far ...
			</p>
			<p>
			Rolling Stone Magazine have compiled a list of their <a href="http://www.rollingstone.com/music/lists/100-greatest-artists-of-all-time-19691231">top 100 musical artists of all time</a>.
			I figure that's probably a pretty good place to start, it's an interesting list with a wide range of artists and some of the entries make for good reading.
			</p>
			<p>
			Using that list as a base I pulled in a discography for each of those artists from 
			<a href="http://lyrics.wikia.com/">LyricWikia</a>, using their <a href="http://api.wikia.com/wiki/LyricWiki_API">API</a>. I wasn't able to collect a discography for all the artists but I got most of them.
			</p>
			<p>
			I then went on to collect the lyrics for those songs from <a href="http://www.chartlyrics.com/">Chartlyrics</a> (I would encourage you to consider contributing to their free community).
			Their API appeared to be rate limited to 1 request every 20 seconds so I ended up scraping the lyrics web pages. I couldn't get all the songs for all the artist but I 
			got enough to work from.
			</p>
			<p>
			Below is a visualisation of the lyrics I collected. I've filtered out the artist where I collected less than 10,000 words. Click an artist lexical density
			bar on the left and a bubble chart with that artist's top N words is presented, N can be adjusted to show more or less words. 
			There is also a set of radio buttons allowing you to filter out sets of words. "None" includes all words in the artitst top list.
			"Common" filters out all words in <a href="http://en.wikipedia.org/wiki/Most_common_words_in_English">Wikipedia's 100 most common words list (just base words, not lexemes)</a>.
			"Pronouns" filters out pronouns.
			The right set of bars shows the number of times each word appears when the top 100 words for all artists are combined. The bar colour 
			changes to match the colour of the word in the bubble chart.
			</p>
			<p>
			<a href="http://en.wikipedia.org/wiki/Lexical_density">Lexical Density</a> seems like a reasonably good indicator of the vocabulary
			used by each artist, it differs from the measure use in the orignal hip hop analysis but I think it allows for a good comparison between 
			these various artists. As a point of reference with the hip hop data, Ice T, pretty much in the middle of the pack, has a lexical 
			density of (4431/35000)*100 = 12.66%. The lowset entry is DMX at 9.18%, and the highest Aesop Rock at a whopping 21.12%.
			</p>
			<p>
			Note: I've just realised that what I've calculated here is not a true lexical density, it's a very simplified approximation. I'm working towards implementing 
			a true lexical density but that may take a bit of time. Until then I think the calculation I've got here still provides a good measure to compare these artists.
			Here's <a href="/museAck/artistFirstN.html">a similar analysis that only looks at the first 20000 words<a> from each artist and doesn't try and calculate lexical density.
			</p>
			<p>
			So that's what I've got at the moment, it's a work in progress and I've got a few more ideas about what I can do with this set of data.
			I'll see where it goes next.
			</p>
			<p>
			(Note: Tool and NOFX do not appear in Rolling Stone's list, they were used in some early test cases 
			for the lyric collection process and I've decided to keep them in there)
			</p>
			
			<style type="text/css">
				span.codedirection { unicode-bidi:bidi-override; direction: rtl; }
			</style>
			<p>Let me know what you think, <span class="codedirection">moc.liamg@timmorton</span></p>
		</div>
		<div id="leftCol" class="column">
			<h1>Artist Lexical Density (Simplified calculation)</h1>
			<p>Click an Artist Below</p>
		</div>
		<div id="centerCol" class="column">
			<h1 id="selectArtistTitle">Most Common Words For Selected Artist</h1>
			<p>
			Number of words = <input id="nWords" type="text" value="10" size="4" onchange="updateTopWordsArtist()"></input>(max 100)     
			<br>Exclude: <input type="radio" name="whichWords" value="None" id="whichIncludeAll" checked="true">None</input>
			<input type="radio" name="whichWords" value="Common Words" id="whichExcludeCommon">Common</input>
			<input type="radio" name="whichWords" value="Pronouns" id="whichExcludePronouns">Pronouns</input>
			</p>
		</div>
		<div id="rightCol" class="column">
			<h1>All Artist Combined Top Words</h1>
		</div>
		<div id="footer"></div>
	</div>
	
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		ga('create', 'UA-52560191-1', 'auto');
		ga('send', 'pageview');

	</script>
	
	<script src="https://fastcdn.org/D3.js/3.5.6/d3.min.js"></script>
	<script src="ratios.js"></script>
	
	<script>
	function getStyle(oElm, strCssRule){
		var strValue = "";
		if(document.defaultView && document.defaultView.getComputedStyle){
			strValue = document.defaultView.getComputedStyle(oElm, "").getPropertyValue(strCssRule);
		}
		else if(oElm.currentStyle){
			strCssRule = strCssRule.replace(/\-(\w)/g, function (strMatch, p1){
				return p1.toUpperCase();
			});
			strValue = oElm.currentStyle[strCssRule];
		}
		return strValue;
	}
	
	var pronouns = "|all|another|any|anybody|anyone|anything|both|each|each|other|either|everybody|everyone|everything|few|he|her|hers|herself|him|himself|his|i|it|its|itself|many|me|mine|more|most|much|myself|neither|no|one|nobody|none|nothing|one|one|another|other|others|ours|ourselves|several|she|some|somebody|someone|something|that|their|theirs|them|themselves|these|they|this|those|us|we|what|whatever|which|whichever|who|whoever|whom|whomever|whose|you|your|yours|yourself|yourselves|";
	// from http://en.wikipedia.org/wiki/Most_common_words_in_English
	var commonWords = "|the|be|to|of|and|a|in|that|have|i|it|for|not|on|with|he|as|you|do|at|this|but|his|by|from|they|we|say|her|she|or|an|will|my|one|all|would|there|their|what|so|up|out|if|about|who|get|which|go|me|when|make|can|like|time|no|just|him|know|take|people|into|year|your|good|some|could|them|see|other|than|then|now|look|only|come|its|over|think|also|back|after|use|two|how|our|work|first|well|way|even|new|want|because|any|these|give|day|most|us|";
	
	// click handler for all the radio buttons
	//var rad = document.myForm.whichWords;
	var rad = document.getElementsByName("whichWords");
	for(var i = 0; i < rad.length; i++) {
		rad[i].onclick = function() {
			updateTopWordsArtist();
		};
	}
	
	///////////////////////////////////////////////////////////////////////////
	// start at the top of the list ...
	var selectedArtistName = "The Velvet Underground";
	var width = document.getElementById("leftCol").offsetWidth,
		barHeight = 12,
		format = d3.format(",d"),
		color = d3.scale.category20c();
	
	width -= parseInt(getStyle(document.getElementById("leftCol"), "padding-right"));
	width -= parseInt(getStyle(document.getElementById("leftCol"), "padding-right"));
	
	var x = d3.scale.linear()
		.range([0, width]);

	var chart = d3.select("#leftCol").append("svg")
		.attr("width", width)
		.attr("class", "chart");;
	
	var artistStats = artistStats(ratios);
	
	x.domain([0, d3.max(artistStats, function(d) { return d.value; })]);
	
	chart.attr("height", barHeight * artistStats.length);
	
	var bar = chart.selectAll("g")
		.data(artistStats)
		.enter().append("g")
		.attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"; });
	
	bar.append("rect")
		.attr("width", function(d) { return x(d.value); })
		.attr("height", barHeight - 1)
		.on("click", function(d) {
						selectedArtistName = d.artistName;
						updateTopWordsArtist();});
	
	bar.append("text")
		//.attr("x", function(d) { return x(d.value) - 3; })
		.attr("x", 3)
		.attr("y", barHeight / 2)
		.attr("dy", ".35em")
		.text(function(d) { return d.artistName + ": " + (d.value*100).toFixed(2) + "%"; })
		.on("click", function(d) {
						selectedArtistName = d.artistName;
						updateTopWordsArtist();});
	
	// Returns a flattened hierarchy containing all leaf nodes under the root.
	function artistStats(root) {
		var classes = [];
		
		for (var i = 0; i < root.length; i++) {
			classes.push({_id: root[i]._id,
							artistName:root[i].value.artistName, 
							ratio: root[i].value.ratio,
							uniqueWordCount: root[i].value.uniqueWordCount,
							totalWordCount: root[i].value.totalWordCount,
							value: root[i].value.ratio});
							//value: 50});
		}
		classes.sort(function(a, b) { return b["ratio"] - a["ratio"]; });
		return classes;
	}
	
	//d3.select(self.frameElement).style("height", diameter + "px");
	///////////////////////////////////////////////////////////////////////////
	</script>
	
	<script>
	///////////////////////////////////////////////////////////////////////////
	var diameter2 = document.getElementById("centerCol").offsetWidth,
		format2 = d3.format(",d"),
		color2 = d3.scale.category20c();
		
	diameter2 -= parseInt(getStyle(document.getElementById("centerCol"), "padding-right"));
	diameter2 -= parseInt(getStyle(document.getElementById("centerCol"), "padding-left"));
	
	var svg2 = d3.select("#centerCol").append("svg")
		.attr("width", diameter2)
		.attr("height", diameter2)
		.attr("class", "bubble");
	
	function updateTopWordsArtist() {
		var nWords = parseInt(document.getElementById("nWords").value, 10);
		var bubble2 = d3.layout.pack()
			.sort(function(a, b) { return a.count > b.count; } )
			.size([diameter2, diameter2])
			.padding(1);
		
		document.getElementById("selectArtistTitle").innerHTML = "Most Common Words For " + selectedArtistName;
		var topWords = artistTopWords(selectedArtistName, top100Words, nWords);
		
		updateAllTopWords(topWords);
		
		var node2 = svg2.selectAll(".node")
			.data(bubble2.nodes(topWords)
					.filter(function(d, i) { return !d.children; }),
				function(d) {return d.word} // key data based on className to keep object constancy
			);
		
		// capture the enter selection
		var nodeEnter = node2.enter()
			.append("g")
			.attr("class", "node")
			.attr("transform", function (d) {
				return "translate(" + 10 + "," + d.y + ")";
			});
		
		// re-use enter selection for circles
		nodeEnter
			.append("circle")
			.attr("r", function (d) {return 0;})
			.style("fill", function (d) {return color2(d.word);});
		
		// re-use enter selection for titles
		nodeEnter
			.append("title")
			.text(function (d) {
				return d.word + ": " + format(d.count);
			});
		
		nodeEnter
			.append("text")
			.attr("dy", ".3em")
			.style("text-anchor", "middle")
			.text(function(d) { return d.word + ": " + d.count; });
		
		node2
			.append("title")
			.text(function (d) {
				return d.word + ": " + format(d.count);
			});
		
		node2.select("text")
			.text(function(d) { return d.word + ": " + d.count; });
			
		node2.select("title")
			.text(function (d) {
				return d.word + ": " + format(d.count);
			});
		
		node2.select("circle")
			.style("fill", function (d) {
				return color2(d.word);
			})
			.transition().duration(3000)
			.attr("r", function (d) {
				return d.r;
			});
	
		node2.transition().duration(3000).attr("class", "node")
			.attr("transform", function (d) {
				return "translate(" + d.x + "," + d.y + ")";
			});
		
		var nodeExit = node2.exit().transition().duration(2000)
			.attr("class", "node")
			.attr("transform", function (d) {
				return "translate(" + (diameter2 - 20) + "," + d.y + ")";
			});;
		nodeExit.transition().duration(2000)
			.select("circle")
			.attr("r", 0);
		nodeExit.transition().duration(5000).remove();
	}
	
	// Returns a flattened hierarchy containing all leaf nodes under the root.
	function artistTopWords(artistName, root, nWords) {
		var topWords = [];
		var excludeCommon = document.getElementById("whichExcludeCommon").checked;
		var excludePronouns = document.getElementById("whichExcludePronouns").checked;
		
		for (var i = 0; i < root.length; i++) {
			if (root[i].artistName === artistName) {
				var artistTopWords = root[i].topWords;
				for (var j = 0; j < artistTopWords.length && topWords.length < nWords; j++) {
					// optionally filter out words
					var pushWord = true;
					if (excludeCommon && commonWords.indexOf("|"+artistTopWords[j].word+"|") !== -1) {	
						pushWord = false;
					} else if (excludePronouns && pronouns.indexOf("|"+artistTopWords[j].word+"|") !== -1) {
						pushWord = false;
					}
					
					if (pushWord) {
						topWords.push({ word: artistTopWords[j].word,
										count: artistTopWords[j].count,
										value: artistTopWords[j].count });
					}
				}
			}		
		}
		return {children: topWords};
	}
	///////////////////////////////////////////////////////////////////////////
	</script>
	<!-- get the big data file here -->
	<script src="artistTop100Words.js"></script>
	<script>
	
	var barHeight3 = 12,
		width3 = document.getElementById("rightCol").clientWidth;
	// remvoe the padding from the width
	width3 -= parseInt(getStyle(document.getElementById("rightCol"), "padding-right"));
	width3 -= parseInt(getStyle(document.getElementById("rightCol"), "padding-left"));
			
	var chart3 = d3.select("#rightCol").append("svg")
		.attr("width", width3)
		.attr("class", "chart3");
			
	updateAllTopWords({children:[]});
	
	// Update the bubble chart now that we've got everything else in order
	updateTopWordsArtist();
	
	function updateAllTopWords(selectTopWords) {
		var x3 = d3.scale.linear()
			.range([0, width3]);
	
		var allArtistsTopWords = allTopWordCounts(top100Words, selectTopWords);
		
		x3.domain([0, d3.max(allArtistsTopWords, function(d) { return d.value; })]);
		
		chart3.attr("height", barHeight3 * allArtistsTopWords.length);
		
		var bar3 = chart3.selectAll("g")
			.data(allArtistsTopWords)
			.style("fill", function (d) {
					if (d.highlight === 1) {
						return color2(d.word);
					} else {
						return "#E6E6E6";
					}
				})
			.enter().append("g")
			.attr("transform", function(d, i) { return "translate(" + (width3 - x3(d.value)) + ", " + i * barHeight3 + ")"; });
		
		bar3.append("rect")
			.attr("width", function(d) { return x3(d.value);})
			.attr("height", barHeight3 - 1);
		
		bar3.append("title")
			.text(function(d) { return d.word + ": " + d.count; });
			
		bar3.append("text")
			.attr("x", function(d) { 
							if (x3(d.value) < 40) {
								return -5 * d.word.length + x3(d.value) - 20; 
							} else {
								return 3
							}
						})
			.attr("y", (barHeight3 / 2))
			.attr("dy", ".35em")
			.text(function(d) { return d.word; });
	}
	
	function allTopWordCounts(allArtistsWords, selectTopWords) {
		var allWords = [];
		var idx = {};
		
		var selectWordsString = "|";
		
		selectTopWords.children.forEach(function (d) { selectWordsString += d.word + "|"; });
		
		// for each artist
		for (var i = 0; i < allArtistsWords.length; i++) {
			var artistTopWords = allArtistsWords[i].topWords;
			// for each word for that artist
			for (var j = 0; j < artistTopWords.length; j++) {
				if (idx.hasOwnProperty(artistTopWords[j].word)) {
					allWords[idx[artistTopWords[j].word]].count += artistTopWords[j].count;
					allWords[idx[artistTopWords[j].word]].value += artistTopWords[j].count;
				} else {
					var highlight = 0;
					if (selectWordsString.indexOf("|"+artistTopWords[j].word+"|") != -1) {	
						highlight = 1;
					}
					idx[artistTopWords[j].word] = allWords.length;
					allWords.push({ word: artistTopWords[j].word,
									highlight: highlight,
									count: artistTopWords[j].count,
									value: artistTopWords[j].count + 5000});
				}
			}
		}
		return allWords.sort(function (a, b) {return b.count - a.count;});
	}
	</script>
	
</body>
</html>
